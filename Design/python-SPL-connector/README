The scripts in this folder query the Elasticsearch database used by
Domeo to retrieve annotations created by specific users. This code is
a work-around until we can build and test Connector plugins that work
with the Annotopia framework: https://github.com/Annotopia

This code uses the official Python interface to Elastic search
(https://github.com/elasticsearch/elasticsearch-py/releases). Complete
documentation for the API is here:
http://elasticsearch-py.readthedocs.org/en/master/api.html

------------------------------------------------------------
Pre-requisites:

* rdflib-4.1.2 and rdflib_jsonld-0.2 

These can be found at the rdflib site and
https://pypi.python.org/pypi/rdflib-jsonld/0.2-dev respectively. They
are necessary to use rdflib's Graph classh's general function for
converting JSON-LD to RDF.

* the appropriate version of Elasticsearch.py:

1) Install the appropriate version of Elasticsearch.py (for Domeo on
Ubuntu running Elastic search 0.90.1 use
https://github.com/elasticsearch/elasticsearch-py/archive/0.4.5.tar.gz)

2) unpack and install

python setup.py build
sudo python setup.py install

3) Mysql DB config file - Domeo-DB-config.txt

USERNAME=<USERNAME>;
PASSWORD=<PASSWORD>;

------------------------------------------------------------
TO RUN

See the convertJsonLDToRDF.py usage by running it with no commandline paramaters. Currently this outputs: 

"convertJsonLDToRDF <query string> <collection> <output file name> <old version>(1: want old versions, 0: only get last version) <verbose>(optional 1=True, 0=False (default)"

Example - query for all annotations belonging to a Domeo user with ID "80808080466465c00146674fe5190024" and write them to RDF in a file called DDI-expert1.xml:

$ python convertJsonLDToRDF.py 80808080466465c00146674fe5190024 devb30 domeo-ddi-annotations-in-rdf-07092014.xml 0

NOTE: results are limited to 10,000 at this time.

NOTE: empty strings in the JSON-LD provided by Elasticsearch are
incorrectly converted to blank nodes by rdflib-jsonld. To address this
issue, the script converts empty strings occurring in the body
component to "<empty>" 

NOTE: Annotations stored by Domeo use "!DOMEO_NS!" as string
placeholder for ":". This is is a leftover from the first days of
JSON-LD where the Domeo architect (Paulo Ciccarese) did not have a
working context in place. For now, the script replaces these strings
before rdflib-jsonld converts the data to RDF.

NOTE: Elasticsearch has multiple sub-graphs under 'domeo' labeled by
'type'. The scripts in this folder query for sets from type 'devb30'
which appears to be the complete graphs for each annotation. The other
types appear to be used for tracking changes. 


------------------------------------------------------------
TO QUERY

1) load the RDF output into an RDF endpoint (e.g., Virtuoso). Give the
graph a very specific name such as "<http://purl.org/net/nlprepository/changed-ddi-expert1-annotation"

2) The queries in example-queries-NLP-DDI.txt show how to query DDI
and Highlight annotations done for a specific source. Note that you
might need to adjust the graph in the FROM part of the query and the
URL in the oa:hasSource predicate. 

------------------------------------------------------------
NOTES ON BUILDING A CONNECTOR (for use with DomeoClient and Domeo)


    (1) Would you please explain for me how the Connectors work and
    what should I do to simulate using a Connector within the
    DomeoClient?  Later on I would like to ask you how to making
    Connectors work on the server for getting and storing data from
    remote server but Prof Boyce suggests that we start with the
    Client.


Connectors are the way Domeo uses to communicate with external
services.  Normally, besides the external web service, there are two
components involved:

a) the connector server side which connects to the external web
service.  The goal of this connector is to send the request and shape
the results in a way that the Domeo client can digest them. An example
of connector is:
https://github.com/domeo/domeo/tree/master/ConnectorNifService I've
added some comments to the code of this one so it might be a good one
to look at.  This particular connector services three different
calls. I will detail this better later on.

Also I've just started a new Connector here:
https://github.com/domeo/domeo/tree/master/ConnectorEpmcService This
is new and evolving, also could be a good example.  Also this could be
a good example as it will do something similar to what you need to do.
In fact EuroPMC has text mining results that have been precomputed and
they want to make them available through Domeo. It seems very similar
use case to yours.

b) the connector client side that connect to the connector server
side.  This is basically providing the logic (and user interfaces) for
the user to query the external web service.  On the client the NIF
connector code is under:
https://github.com/domeo/DomeoClient/tree/master/src/org/mindinformatics/gwt/domeo/plugins/resource/nif
Start looking at that structure.

-- 
Dr. Paolo Ciccarese
http://www.paolociccarese.info/
